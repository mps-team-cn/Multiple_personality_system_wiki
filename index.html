<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>é¦–é¡µ - Plurality Wiki</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- åŸºç¡€ä¸»é¢˜ï¼ˆDocsify å®˜æ–¹ï¼‰ -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/docsify@4/themes/vue.css"
    />

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="./assets/custom.css" />

    <!-- ç«™ç‚¹å›¾æ ‡ï¼ˆä½¿ç”¨çº¯ SVG ä»¥é¿å…äºŒè¿›åˆ¶æ–‡ä»¶é™åˆ¶ï¼‰ -->
    <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml" />
  </head>
  <body>
    <div id="app"></div>

    <script>
      (function () {
        const ensureTrailingSlash = (path) =>
          path.endsWith("/") ? path : `${path}/`;
        const { pathname } = window.location;
        const basePath = ensureTrailingSlash(pathname.replace(/[^/]*$/, ""));

        const alias = {
          "/.*/_navbar.md": "_navbar.md",
          "/.*/_sidebar.md": "_sidebar.md",
        };

        const normalizePath = (raw) => {
          const [rawPath, query = ""] = raw.split("?");
          const segments = rawPath.split("/").filter(Boolean);
          const stack = [];

          for (const segment of segments) {
            if (segment === "..") {
              if (stack.length) stack.pop();
            } else if (segment !== ".") {
              stack.push(segment);
            }
          }

          const normalizedPath = stack.join("/");
          return normalizedPath + (query ? `?${query}` : "");
        };

        const canonicalizeHash = (() => {
          let adjusting = false;

          const updateHash = (hash, notifyRouter) => {
            const { origin, pathname, search } = window.location;
            const newUrl = `${origin}${pathname}${search}${hash}`;

            adjusting = true;
            history.replaceState(null, "", newUrl);

            if (notifyRouter) {
              const event =
                typeof HashChangeEvent === "function"
                  ? new HashChangeEvent("hashchange")
                  : new Event("hashchange");
              window.dispatchEvent(event);
            }

            adjusting = false;
          };

          return (notifyRouter = false) => {
            if (adjusting) return;

            const { hash } = window.location;
            if (!hash || !hash.startsWith("#/")) return;

            const normalizedPath = normalizePath(hash.slice(2));
            const normalizedHash = `#/${normalizedPath}`;

            if (normalizedHash !== hash) {
              updateHash(normalizedHash, notifyRouter);
            }
          };
        })();

        window.addEventListener(
          "hashchange",
          () => canonicalizeHash(true),
          true
        );
        canonicalizeHash();

        const shouldHandleInternally = (href) => {
          if (!href || href.startsWith("#")) return false;
          if (/^[a-zA-Z]+:/i.test(href)) return false;
          if (href.startsWith("//")) return false;
          return true;
        };

        const resolveTarget = (href) => {
          const [pathAndQuery = "", hashFragment = ""] = href.split("#");
          const [rawPath = "", rawQuery = ""] = pathAndQuery.split("?");
          const queryPart = rawQuery ? `?${rawQuery}` : "";

          const currentBaseSegments = (() => {
            const { hash } = window.location;
            if (!hash || !hash.startsWith("#/")) return [];

            const [currentPath = ""] = hash.slice(2).split("?");
            const segments = currentPath.split("/").filter(Boolean);
            if (segments.length) segments.pop();
            return segments;
          })();

          const isAbsolutePath =
            rawPath.startsWith("/") || rawPath.startsWith("entries/");
          const baseTrimmed = basePath.replace(/^\/+|\/+$/g, "");
          let workingPath = rawPath.replace(/^\/+/, "");
          if (baseTrimmed && workingPath.startsWith(`${baseTrimmed}/`)) {
            workingPath = workingPath.slice(baseTrimmed.length + 1);
          }
          const pathSegments = workingPath
            .split("/")
            .filter((segment) => segment.length);

          const stack = isAbsolutePath ? [] : [...currentBaseSegments];

          for (const segment of pathSegments) {
            if (segment === ".") continue;
            if (segment === "..") {
              if (stack.length) stack.pop();
              continue;
            }
            stack.push(segment);
          }

          const resolvedPath = stack.join("/");
          const anchorQuery = hashFragment
            ? (queryPart ? `${queryPart}&` : "?") +
              `id=${encodeURIComponent(hashFragment)}`
            : queryPart;

          return `${resolvedPath}${anchorQuery}`;
        };

        document.addEventListener("click", (event) => {
          const anchor = event.target.closest("a[href]");
          if (!anchor) return;
          if (anchor.target && anchor.target !== "" && anchor.target !== "_self")
            return;

          const href = anchor.getAttribute("href");
          if (!shouldHandleInternally(href)) return;

          event.preventDefault();

          const target = resolveTarget(href);
          const normalized = normalizePath(target);
          const cleanPath = normalized.replace(/\.md(?=$|\?)/i, "");
          const newHash = `#/${cleanPath}`;

          if (window.location.hash !== newHash) {
            window.location.hash = newHash;
          } else {
            canonicalizeHash(true);
          }
        });

        window.$docsify = {
          name: "å¤šæ„è¯†ä½“Wikipedia",
          repo: "kuliantnt/plurality_wiki",
          basePath,
          // å¯¼èˆª/ä¾§è¾¹
          loadNavbar: true,
          loadSidebar: true,
          subMaxLevel: 2,
          auto2top: true,

          // é¦–é¡µç›´æ¥å±•ç¤º Main_Pageï¼ˆHTML ç‰ˆæœ¬ï¼‰ï¼Œæ— éœ€å°é¢
          coverpage: false,
          onlyCover: false,
          homepage: "Main_Page.html",

          // è‡ªå®šä¹‰ 404 é¡µé¢
          notFoundPage: "_404.md",

          // é¡µè„šï¼ˆæ”¾åœ¨ _sidebar.md æœ«å°¾è¿½åŠ ä¹Ÿè¡Œï¼‰
          footer: {
            copy:
              "<span>Â© " + new Date().getFullYear() + " plurality_wiki</span>",
            auth: "ç”± è„¸è„¸ç³»ç»Ÿ ç¼–å†™",
            pre: "<hr/>",
            style: "text-align:center;",
          },

          // åˆ†é¡µ
          pagination: {
            previousText: "ä¸Šä¸€é¡µ",
            nextText: "ä¸‹ä¸€é¡µ",
            crossChapter: true,
          },

          alias,
        };

        // ç®€æ˜“æš—é»‘æ¨¡å¼å¼€å…³ï¼ˆå†™ä¸€ä¸ªå…¨å±€ classï¼‰
        const key = "theme-dark";
        const root = document.documentElement;
        const saved = localStorage.getItem(key);
        if (saved === "1") root.classList.add("dark");

        window.toggleTheme = function () {
          root.classList.toggle("dark");
          localStorage.setItem(
            key,
            root.classList.contains("dark") ? "1" : "0"
          );
        };
      })();
    </script>

    <!-- è‡ªå®šä¹‰æ ‡é¢˜æœç´¢ï¼ˆéœ€åœ¨ Docsify å¯åŠ¨å‰æ³¨å†Œæ’ä»¶ï¼‰ -->
    <script src="./assets/title-search.js"></script>

    <!-- é¡µé¢æ ‡é¢˜åç¼€æ§åˆ¶ -->
    <script src="./assets/title-suffix.js"></script>

    <!-- ä¸­è‹±æ··æ’æ’ç‰ˆä¼˜åŒ– -->
    <script src="./assets/typography.js"></script>

    <script>
      (function () {
        const PLACEHOLDER_ID = "__last-updated__";

        let lastUpdatedMapPromise = null;

        function loadMap() {
          if (!lastUpdatedMapPromise) {
            lastUpdatedMapPromise = fetch("./assets/last-updated.json", {
              cache: "no-store",
            })
              .then((response) => (response.ok ? response.json() : {}))
              .catch(() => ({}));
          }
          return lastUpdatedMapPromise;
        }

        function routeToRepoPath(routePath) {
          if (!routePath) return null;
          let path = routePath.replace(/^\//, "");
          if (path.endsWith("/")) path = path.slice(0, -1);
          if (!path) return null;
          return decodeURIComponent(path) + ".md";
        }

        function formatDate(isoString) {
          if (!isoString) return null;
          const date = new Date(isoString);
          if (Number.isNaN(date.getTime())) return null;
          const pad = (value) => String(value).padStart(2, "0");
          const year = date.getFullYear();
          const month = pad(date.getMonth() + 1);
          const day = pad(date.getDate());
          const hours = pad(date.getHours());
          const minutes = pad(date.getMinutes());
          const seconds = pad(date.getSeconds());
          return `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;
        }

        function injectPlaceholder(html) {
          const placeholder = `\n<div id="${PLACEHOLDER_ID}" style="font-size:0.9em;opacity:.8;margin:8px 0;"></div>`;
          if (/<h1[^>]*>[\s\S]*?<\/h1>/i.test(html)) {
            return html.replace(/(<h1[^>]*>[\s\S]*?<\/h1>)/i, `$1${placeholder}`);
          }
          return `${placeholder}\n${html}`;
        }

        window.$docsify = window.$docsify || {};
        const userPlugins = window.$docsify.plugins || [];

        window.$docsify.plugins = [].concat(
          function (hook, vm) {
            hook.afterEach(function (html, next) {
              next(injectPlaceholder(html));
            });

            hook.doneEach(async function () {
              const container = document.getElementById(PLACEHOLDER_ID);
              if (!container) return;

              const repoPath = routeToRepoPath(vm.route && vm.route.path);
              const map = await loadMap();
              const info = repoPath && map[repoPath];

              if (info && info.updated) {
                const formatted = formatDate(info.updated);
                const shortHash = info.commit ? info.commit.slice(0, 7) : "";
                if (formatted) {
                  container.innerHTML = `ğŸ•’ æœ€åæ›´æ–°ï¼š<strong>${formatted}</strong>${
                    shortHash ? `ï¼ˆ<code>${shortHash}</code>ï¼‰` : ""
                  }`;
                  container.style.display = "";
                  return;
                }
              }

              container.innerHTML = "";
              container.style.display = "none";
            });
          },
          userPlugins
        );
      })();
    </script>

    <!-- é¦–é¡µæœ€è¿‘æ›´æ–°æ¨¡å— -->
    <script src="./assets/recent-home.js"></script>

    <!-- æœ€è¿‘æ›´æ–°é¡µé¢è‡ªåŠ¨ç”Ÿæˆ -->
    <script src="./assets/recent-page.js"></script>

    <!-- Docsify æ ¸å¿ƒ -->
    <script src="https://cdn.jsdelivr.net/npm/docsify@4/lib/docsify.min.js"></script>

    <!-- æ’ä»¶ï¼šå¤åˆ¶ä»£ç  / å›¾ç‰‡ç¼©æ”¾ / åˆ†é¡µ / emoji -->
    <script src="https://cdn.jsdelivr.net/npm/docsify-copy-code"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js"></script>

    <!-- å¯é€‰ï¼šPrism è¯­æ³•é«˜äº®ï¼ˆæŒ‰éœ€æ·»åŠ è¯­è¨€ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markdown.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-bash.min.js"></script>
    <div class="theme-toggle" onclick="toggleTheme()">ğŸŒ“ åˆ‡æ¢ä¸»é¢˜</div>
  </body>
</html>
